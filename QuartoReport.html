<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.5.57" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Olivia Moody (2519203), Minsol Kim (2495685), and Simon Liu (2487435)" />
<meta name="dcterms.date" content="2024-12-08" />

<title>QTM 350 Final Project: Finding the Key to GDP Growth in Developing, Transitionary and Developed Nations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>

<!-- htmldependencies:E3FAD763 -->


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">QTM 350 Final Project: Finding the Key to GDP Growth in Developing, Transitionary and Developed Nations</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Olivia Moody (2519203), Minsol Kim (2495685), and Simon Liu (2487435) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 8, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2>Introduction</h2>
<p>As transportation, technology and media advance at breaknecking speed, the world’s economies have become significantly more interconnected and global than ever before. While many countries have been able to use these advancements to aid in their development, many others are still in transitionary or developing stages and find themselves with imbalanced imports and exports. In order evaluate economic change over time, we sought to explore the metric of GDP growth rate in developing and developed countries over time. More specifically, we wanted to answer the question: Are economic and educational attainment metrics correlated with increased GDP growth rate? Is this correlation found in both developed and developing countries? For this analysis we focused on the the relationship between unemployment rate, inflation rate, and government expenditure on education to GDP growth rate. Then we examined the potential for collinearity (confounding variables), using a correlation matrix, of all nine extracted independent economic and educational variables.</p>
<p>Overall, we found that inflation rate was the only metric that had a positive correlation to GDP growth rate and that it was somewhat consistent on in developing and developed countries. While unemployment rate had a negative correlation to GDP growth rate for both types of economies, it had a much larger correlation for developing countries. Finally, government expenditures on education had a negative correlation with GDP Growth Rate only in developing countries but almost no correlation on average in developed countries. In our analysis of independent health and education variables, we found that health factors were signficantly more correlated with one another than educational factors.</p>
</section>
<section id="data-description" class="level2">
<h2>Data Description</h2>
<p>The data for this project originates from the public World Bank World Development Indicators database. As an organization, the World Bank seeks to provide key financial and educational assistant to in developing countries’ so that they may develop infrastructure and advance economically. In support of their mission, the organization collects reliable data from recognised international agencies and organizations to produce the database used in this project. While the World Bank has more than 1,600 indicators for 217 economies spanning as far back as 1960, we focused on only nine indicators from the years of 2000 to 2022. These nine indicators span the topics of economics, education, and population. In order to refine our research question and specify our scope, we chose to complete our analysis on five developed nations and 6 developing nations which can be shown in the table below.</p>
<div id="c6d6c9ed" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="2">
<table border="1" class="dataframe">

<thead>

<tr style="text-align: right;">

<th>
Developed Countries
</th>

<th>
Developing Countries
</th>

</tr>

</thead>

<tbody>

<tr>

<td>
United States of America
</td>

<td>
Russia
</td>

</tr>

<tr>

<td>
Australia
</td>

<td>
Brazil
</td>

</tr>

<tr>

<td>
United Kingdom
</td>

<td>
China
</td>

</tr>

<tr>

<td>
Germany
</td>

<td>
India
</td>

</tr>

<tr>

<td>
New Zealand
</td>

<td>
South Africa
</td>

</tr>

<tr>

<td>
</td>

<td>
Ethiopia
</td>

</tr>

<tr>

<td>
</td>

<td>
</td>

</tr>

</tbody>

</table>
</div>
</div>
<p>We chose these nations as their economies repersent some of the largest in the world and they take on a repersent a nuanced and wide definition of the concept of a developing and developed nation. The two specific countries we want to note in this analysis are China and Russia as they are a case example of large, rich economies that often fall under a grey zone of a transitionary economy. While many consider China and Russia developed, both do not yet meet the conditions under the United Nations to be developed. To understand this before we made our classifications, we looked plotted each countries’ GDP per capita from 1960 to now. As You can see if the following graph, Russia and China fall very similiarly historically but even still today with the other developing countries of our study. While GDP per Capita is not the only significant metric to a country’s status as developed, we wanted to illustrate and make clear our classifications and their foundings.</p>
<p><img src="figures/GDP_per_Capita_Over_Time_for_All_Economies.png" class="img-fluid" style="width:100.0%" /></p>
<section id="data-merging" class="level3">
<h3>Data Merging</h3>
<p>To complete our analysis we utilised SQL to extract four economic indicators, three health indicators and three population indicators from the World Bank’s database. The following entity relationship diagram shows this extraction and the usage of economy as a primary key amongst them.</p>
<p><img src="documentation/Entity_Relationship_Diagram.png" class="img-fluid" style="width:100.0%" /></p>
</section>
<section id="data-cleaning-and-pre-processing-procedures" class="level3">
<h3>Data Cleaning and Pre-processing Procedures</h3>
<p>While we extracted population variables, economic variables, and health variables to evaluate variables most correlated with changes in GDP growth rate over time, we quickly found in data cleaning that certain variables were less usable than others. Specifically in developing countries, the health and educational metrics often did not include enough or completed time series data to preform our analysis. As a result, we relied on a smaller set of key variables which had statistical power.</p>
</section>
<section id="key-variables" class="level3">
<h3>Key Variables</h3>
<p>The key variables relied upon in this paper were unemployment rate, inflation rate, government expenditure on education, and GDP growth rate.</p>
<p><strong>Unemployment Rate</strong>: The unemployment rate measures the percentage of the labor force that is actively seeking but unable to find employment. Many see it as a proxy for the health of a country’s labor market and economy.</p>
<p><strong>Inflation Rate</strong>: The inflation rate indicates the annual percentage change in the average price level of goods and services in an economy over a specific period. In other words, the inflation rate shows how the purchasing power of a country’s currency is changing over time.</p>
<p><strong>Government Expenditure on Education</strong>: This indicator represents the government’s spending on the educational sector as a percentage of the economy’s GDP. The World Bank includes expenditures funded by international sources to the government and defines government as consisting of local, regional and central branches. Generally this measure reflects the government’s investment in human capital development.</p>
<p><strong>GDP Growth Rate</strong>: The GDP growth rate measures the annual percentage change in a country’s gross domestic product (GDP), which indicates the overall economic growth or contraction of a country. The World Bank defines this as the sum of gross value added by all resident produces in the economy and product taxes minus subsidies otherwise not included in products’ values. It should be noted, especially for developing countries which are often depended on for natural resources and minerals, that the GDP and its growth rate does not reflect any depreciation or damage of natural resources. GDP growth rate is thought of as a key indicator of economic performance and stability.</p>
</section>
</section>
<section id="data-analysis" class="level2">
<h2>Data Analysis</h2>
<p>To best visualise our results we have displayed all plots of developing countries on the left and all plots of developed countries on the right.</p>
<section id="the-economic-story-tracking-unemployment-and-inflation-rate-to-gdp-growth-rate" class="level3">
<h3>The Economic Story: Tracking Unemployment and Inflation Rate to GDP Growth Rate</h3>
<p>In term of economic indicators, the first key difference in our aggregate of developing and developed economies is the range of GDP growth rate, inflation rate and unemployment rate. As you can see in both the plots below, the GDP growth rate takes on a slightly larger range for our aggregate of developing countries. The more significant trend, however is that the dispersal of points across the range is more consistently varied in developing countries than developed ones. While there is a few years of outliers in the developing countries, such as Great Britain in 2008 reaching a horrific GDP growth rate below -10%, the devloped countries over time have a much tighter dispersal to one another. We can also see this is in the error bands of the developing countries being consistently thicker than the error bands of developed countries. We can credit this to developing economies being both more unique to each other than the grouping of developed nations as well as the developing nations having larger changes economies through time. It should be noted that in the same way developing nations sometimes had large declines, they had similiarly high peaks unlike the developing nations which almost never rose above a GDP growth rate above 5% and remained relatively stable through time.</p>
<p>The correlation between unemployment and GDP growth rate is negative in both sets of economies but with a much larger correlation in developing countries. Unlike the other metrics, which had a decently similiar dispersal of the countries in each classification, South Africa (ZAF) had a consistently much higher unemployment rate than the rest of the developing countries. THis country also tended to be both much above and much below the correlation line cementing its status as a outlier in the data.</p>
<div class="columns">
<p><img src="figures/Relationship_UnemploymentRate_GDPGrowthRate_DevelopingCountries.png" class="img-fluid" style="width:45.0%" /> <img src="figures/Relationship_UnemploymentRate_GDPGrowthRate_Developed_Countries.png" class="img-fluid" style="width:45.0%" /></p>
</div>
<p>The correlation between annual inflation rate and GDP growth rate had a slightly positive correlation in both developing and developed economies with again much smaller error estimations for developing nations. Inflation rate being a more consistent correlation across developed and developing economies than unemployment rate could be explained by the fact that inflation is influenced by broader macroeconomic factors, such as monetary policy, global commodity prices, and supply-demand dynamics, which tend to have more uniform effects across economies. In contrast, unemployment is more closely tied to country-specific factors like labor market conditions, structural issues, and social policies, which can vary widely between developed and developing nations, leading to less consistent correlations.</p>
<div class="columns">
<p><img src="figures/Relationship_InflationRate_GDPGrowthRate_DevelopingCountries.png" class="img-fluid" style="width:45.0%" /> <img src="figures/Relationship_InflationRate_GDPGrowthRate_DevelopedCountries.png" class="img-fluid" style="width:45.0%" /></p>
</div>
</section>
<section id="the-education-story-tracking-government-education-expenditures-and-gdp-growth-rate" class="level3">
<h3>The Education Story: Tracking Government Education Expenditures and GDP Growth Rate</h3>
<p>The correlation between government expenditures on education and GDP growth rate was suprisingly negative in developing countries but neutral in developed countries. This was the only indicator in which the range was decently similiar among the two classifications, with government expenditures making up between 2 and 7 percent in developing countries and between about 4 and 7 percent in developing countries, which gives added signficance to the different in trend between the educational and economic metrics. A possible explanation for this trend could be that in developing countries, government spending on education may not always be efficiently allocated or may be hindered by structural issues such as corruption, inadequate infrastructure, or a lack of educators, which limits its impact on economic growth. In contrast, in developed countries, education systems are generally more established and better funded, leading to a more neutral relationship with GDP growth.</p>
<div class="columns">
<p><img src="figures/GovernmentEducationExpenditures_GDPGrowthRate_Developing.png" class="img-fluid" style="width:45.0%" /> <img src="figures/GovernmentEducationExpenditures_GDPGrowthRate_Developed.png" class="img-fluid" style="width:45.0%" /></p>
</div>
</section>
<section id="correlation-between-education-economy-and-health-metrics" class="level3">
<h3>Correlation Between Education, Economy and Health Metrics</h3>
<p><img src="figures/CorrelationMatrix_Independent_Variables.png" class="img-fluid" style="width:100.0%" /></p>
<p>The indicators with the highest correlation between one another were life expectancy at birth and infant mortality rate. This correlation was -0.89 meaning that when infant mortality was increased, life expectancy at birth was very commonly also decreased. The indicators with the lowest correlation were inflation rate and unemployment rate which had a very neutral correlation of -0.01.</p>
</section>
</section>
<section id="results-and-discussion" class="level2">
<h2>Results and Discussion</h2>
<p>In summary, the data suggest that developing economies are much more prone to economic volatility than developed ones, with higher growth potential but also higher risks. While the negative correlation between unemployment and GDP growth is consistent with economic theory, the strength of this relationship varies, with developing countries exhibiting more sensitivity to fluctuations. South Africa’s outlier status further highlights the complexity of unemployment trends in developing countries, where factors like inequality, historical legacies, and a limited labor market can significantly distort the typical patterns seen in other emerging economies. Future research could explore the specific explanations behind South Africa’s high unemployment rates and investigate whether similar patterns are observable in other nations with comparable structural challenges.</p>
<p>While the results of educational investments to growth rate were somewhat suprising as we often hear of education as a key to economic sucess we must remember it is a very lagging indicator which will not show economic impact immediately. In a developing country, a significant portion of GDP growth may be driven by other factors, such as resource extraction, which are less dependent on educational expenditures. While education is crucial for long-term development, its immediate effect on GDP growth may be less pronounced in developing countries compared to their developed counterparts, where the link between education and economic productivity may already be more fully realized.</p>
<p>In terms of indicator coorelation, we unsuprisingly found that health indicators, such as infant mortality, life expectancy at birth, and population growth rate, were correlated highest with each other. This can be explained by the fact that a lot of these metrics are somehow baked into one another or repersent a smaller subset of general health indicators. For instance, if infant mortality rate as a percentage of births is high, life expectancy at birth must be low by virtue of being oppositional forces. In other words, the health indicators are a lot less independent than the economic indicators.</p>
<p>Economic indicators were in general much less correlated with each other which make sense in the general understanding that inflation rate is a measure of change in currency value while unemployment rate is a measure of change in available employment and human behavior. While they are both heavily associated with the economy, they do not both boil down to a identical root observation like the health metrics do to human life span.</p>
<p>A key limitation of this study is its limited data to developing countries. As described before many factors of health and education are not able to be accurately studied as the World Bank does not have reliable and consistent data through time of these countries. This has large implications when we think of the power of data in telling a country’s stories. Without a sound story it is hard for organizations, governments, and charities to accurately understand and meet developmental needs. Particuarly in developing countries with little governmental transparency, many markers of human development are hard to follow through time and accurately gauge the effects of policy, conflict, and environmental impacts. Utilising other data sources that specialise on these countries could be a possible way of perservering against this limitation in the future.</p>
</section>
<section id="conclusion" class="level2">
<h2>Conclusion</h2>
<p>Overall the World Bank’s Developmental Indicators is an amazing way to find and study trends in different types of economies. While developing countries economies are on average more subject to short term impacts, they also have the largest room to grow in advance. Understanding the key factors that lead to GDP growth rate is essential to making a path towards a future where people in every region of the world can have access to basic education, health, and opportunity.</p>
</section>

</main>
<!-- /main column -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->

</body>

</html>
